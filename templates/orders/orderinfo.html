{% extends 'base.html' %}
{% block content %}
<div class="container py-4">
    <h2 class="mb-4 bg-primary text-center text-white">我的訂單</h2>
    <table class="table table-bordered table-hover">
        <thead class="table-light">
            <tr>
                <th>訂單日期</th>
                <th>訂單編號</th>
                <th>付款狀態</th>
                <th>出貨狀態</th>
            </tr>
        </thead>
        <tbody>
            {% for order in orders %}
            <tr>
                <td>{{ order.order_date|date:"Y-m-d H:i" }}</td>
                <td>
                    <a href="?order_id={{ order.id }}">
                        {{ order.invoice_no }}
                    </a>
                </td>
                <td>{{ order.payment_status }}</td>
                <td>{{ order.shipping_status }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4" class="text-center">沒有訂單紀錄</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
<br>
<br>
    {% if selected_order %}
    <hr>
    <h4 class="mb-3">訂單明細</h4>
    <div class="row mb-2">
        <div class="col-md-3"><strong>訂單日期：</strong> {{ selected_order.order_date|date:"Y-m-d H:i" }}</div>
        <div class="col-md-3"><strong>訂單編號：</strong> {{ selected_order.invoice_no }}</div>
        <div class="col-md-3"><strong>付款狀態：</strong> {{ selected_order.payment_status }}</div>
        <div class="col-md-3"><strong>出貨狀態：</strong> {{ selected_order.shipping_status }}</div>
    </div>
    <div class="row mb-2">
        <div class="col-md-4"><strong>收件人：</strong> {{ selected_order.receipient }}</div>
        <div class="col-md-4"><strong>電話：</strong> {{ selected_order.receipient_phone }}</div>
        <div class="col-md-4"><strong>地址：</strong> {{ selected_order.shipping_address }}</div>
    </div>
    <table class="table align-middle">
        <thead>
            <tr>
                <th style="width: 150px; text-align: center;">商品</th>
                <th style="min-width: 220px;">商品簡介</th>
                <th style="width: 160px; text-align: center;">單價</th>
                <th style="width: 160px; text-align: center;">數量</th>
                <th style="width: 160px; text-align: center;">價錢</th>
            </tr>
        </thead>
        <tbody>
            {% for item in order_items %}
            <tr>
                <td class="align-middle text-center">
                    <div class="d-flex justify-content-center align-items-center" style="height: 100%;">
                        {% if item.bookid.photo_small %}
                        <img src="{{ item.bookid.photo_small.url }}" class="img-thumbnail" alt="Product" style="max-width: 150px;">
                        {% endif %}
                    </div>
                </td>
                <td class="align-middle">
                    <strong>{{ item.bookid.title }}</strong>
                    <p class="mb-0 text-muted small">
                        {{ item.bookid.author }}<br>
                        {{ item.bookid.introduction }}<br>
                        {{ item.bookid.category }}
                    </p>
                </td>
                <td class="align-middle text-center">{{ item.unit_price }}</td>
                <td class="align-middle text-center">{{ item.quantity }}</td>
                <td class="align-middle text-center">{{ item.subTotal }}</td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <td colspan="3"></td>
                <td class="text-left align-middle fw-bold">總數量：<span id="total-qty">{{ total_quantity }}</span></td>
                <td class="text-left align-middle unfold"><span id="total-amount" unfold>總金額：{{ total_amount }}</span></td>
            </tr>
        </tfoot>
    </table>
    {% endif %}
</div>
{% endblock %}